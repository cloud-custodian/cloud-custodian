.. _s3:

Simple Storage Service (S3)
===========================

Filters
-------

- Standard Value Filter (see :ref:`filters`)

``global-grants``
  Check bucket acls for global grants

  .. c7n-schema:: GlobalGrantsFilter
      :module: c7n.resources.s3

``missing-policy-statement``
  Find buckets missing a set of named policy statements

  .. c7n-schema:: MissingPolicyStatementFilter
      :module: c7n.resources.s3

``c7n:DeniedMethods``
  A list of AWS methods that resulted in ``AccessDenied`` when called on the
  specified bucket.

  S3 buckets are augmented during resource aggregation, i.e. ``get_bucket_location``,
  ``get_bucket_tagging``, etc. However, as buckets have resource level IAM
  policies (bucket policy), not all buckets will return all augmentations. A full
  list of augmentations can be found in ``c7n.resources.s3.S3_AUGMENT_TABLE``.

  Use this annotation on the resource to ensure actions and filters are only
  enforced on buckets that were augmented.

  .. code-block:: yaml

    policies:
      - name: delete-non-owner-bucket
        resource: s3
        comment: |
          Checks that custodian was able to retrieve tags before performing
          delete action
        filters:
          - type: value
            value_type: swap
            key: "'c7n:DeniedMethods'"
            value: get_bucket_tagging
            op: ni
          - "tag:Owner": absent
        actions:
          - delete

Actions
-------

``encrypt-keys``
  Scan all keys in a bucket and optionally encrypt them in place

  .. c7n-schema:: EncryptExtantKeys
      :module: c7n.resources.s3

``encryption-policy``
  Attach an encryption required policy to a bucket, this will break
  applications that are not using encryption, including AWS log
  delivery

  .. c7n-schema:: EncryptionRequiredPolicy
      :module: c7n.resources.s3

``delete-global-grants``
  Delete global grants from bucket ACLs

  .. c7n-schema:: DeleteGlobalGrants
      :module: c7n.resources.s3

``no-op``
  No operation

  .. c7n-schema:: NoOp
      :module: c7n.resources.s3
