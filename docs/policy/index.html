

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Policy &mdash; Cloud Custodian 1.0 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/c1_labs.png"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="Cloud Custodian 1.0 documentation" href="../index.html"/>
        <link rel="next" title="Lambda Support" href="lambda.html"/>
        <link rel="prev" title="Tag Compliance Across Resources (EC2, ASG, ELB, S3, etc)" href="../usecases/usecases/tagcompliance.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> Cloud Custodian
          

          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul>
<li class="toctree-l1"><a class="reference internal" href="../overview/index.html">Overview</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../quickstart/index.html">Quickstart</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../usecases/index.html">Use Cases</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Policy</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#sample-policy">Sample Policy</a></li>
<li class="toctree-l2"><a class="reference internal" href="#terms">Terms</a></li>
<li class="toctree-l2"><a class="reference internal" href="#real-time-policies">Real-time Policies</a><ul>
<li class="toctree-l3"><a class="reference internal" href="lambda.html">Lambda Support</a></li>
<li class="toctree-l3"><a class="reference internal" href="mu.html">Mu - Lambda Lifecycle Management</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#filters">Filters</a><ul>
<li class="toctree-l3"><a class="reference internal" href="filters.html">Value Filters</a></li>
<li class="toctree-l3"><a class="reference internal" href="filters.html#jmespath-filter">JMESPath Filter</a></li>
<li class="toctree-l3"><a class="reference internal" href="usage.html">Usage</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#resources-and-actions">Resources and Actions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="resources/ami.html">Amazon Machine Images (AMI)</a></li>
<li class="toctree-l3"><a class="reference internal" href="resources/asg.html">Auto Scaling Groups (ASG)</a></li>
<li class="toctree-l3"><a class="reference internal" href="resources/cache-cluster.html">ElastiCache Clusters</a></li>
<li class="toctree-l3"><a class="reference internal" href="resources/cache-snapshot.html">ElastiCache Cluster Snapshots</a></li>
<li class="toctree-l3"><a class="reference internal" href="resources/cfn.html">CloudFormation</a></li>
<li class="toctree-l3"><a class="reference internal" href="resources/ebs.html">Elastic Block Store Volumes (EBS Volumes)</a></li>
<li class="toctree-l3"><a class="reference internal" href="resources/ebs-snapshot.html">Elastic Block Store Snapshots (EBS Snapshots)</a></li>
<li class="toctree-l3"><a class="reference internal" href="resources/ec2.html">Elastic Cloud Compute (EC2)</a></li>
<li class="toctree-l3"><a class="reference internal" href="resources/elb.html">Elastic Load Balancers (ELB)</a></li>
<li class="toctree-l3"><a class="reference internal" href="resources/kms.html">Key Management Service (KMS)</a></li>
<li class="toctree-l3"><a class="reference internal" href="resources/rds.html">Relational Database Service (RDS)</a></li>
<li class="toctree-l3"><a class="reference internal" href="resources/rds-cluster.html">Relational Database Service DB Clusters (RDS DB Clusters)</a></li>
<li class="toctree-l3"><a class="reference internal" href="resources/rds-cluster-snapshot.html">Relational Database Service DB Cluster Snapshots (RDS DB Cluster Snapshots)</a></li>
<li class="toctree-l3"><a class="reference internal" href="resources/rds-snapshot.html">Relational Database Service DB Snapshots (RDS DB Snapshots)</a></li>
<li class="toctree-l3"><a class="reference internal" href="resources/redshift.html">Redshift</a></li>
<li class="toctree-l3"><a class="reference internal" href="resources/s3.html">Simple Storage Service (S3)</a></li>
</ul>
</li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">Cloud Custodian</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
    <li>Policy</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="policy">
<span id="id1"></span><h1>Policy<a class="headerlink" href="#policy" title="Permalink to this headline">¶</a></h1>
<div class="section" id="sample-policy">
<h2>Sample Policy<a class="headerlink" href="#sample-policy" title="Permalink to this headline">¶</a></h2>
<p>In this sample policy we are querying for only running EC2
instances. Based on the list that comes back we are then filtering for EC2
instances that are: not part of an Auto Scaling Group (ASG), not
already marked for an operation, have less than 10 tags, and are missing one or more
of the required tags. Once Custodian has filtered the list, it will
mark all EC2 instances that match the above criteria with a tag. That tag specifies an action
that will take place at a certain time. This policy is one of three that
are needed to manage tag compliance. The other two policies in this set are, 1)
checking to see if the tags have been corrected before the four day period
is up, and 2) performing the operation of stopping all instances
with the status to be stopped on that particular day.</p>
<div class="highlight-yaml"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ec2-tag-compliance-mark</span>
  <span class="l l-Scalar l-Scalar-Plain">resource</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ec2</span>
  <span class="l l-Scalar l-Scalar-Plain">comment</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">|</span>
    <span class="no">Mark non-compliant, Non-ASG EC2 instances with stoppage in 4 days</span>
  <span class="l l-Scalar l-Scalar-Plain">query</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">instance-state-name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">running ──▶ Only apply filter to running instances</span>
  <span class="l l-Scalar l-Scalar-Plain">filters</span><span class="p p-Indicator">:</span>
<span class="l l-Scalar l-Scalar-Plain">▣──────  - &quot;tag:aws:autoscaling:groupName&quot;</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">absent</span>
<span class="l l-Scalar l-Scalar-Plain">│▣─────  - &quot;tag:c7n_status&quot;</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">absent</span>
<span class="l l-Scalar l-Scalar-Plain">│ │ ▣─── - type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">tag-count</span>
<span class="l l-Scalar l-Scalar-Plain">│ │ │    - or</span><span class="p p-Indicator">:</span>                           <span class="l l-Scalar l-Scalar-Plain">─┐</span>
<span class="l l-Scalar l-Scalar-Plain">│ │ │      - &quot;tag:Owner&quot;</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">absent          ├─If any of these tags are</span>
<span class="l l-Scalar l-Scalar-Plain">│ │ │      - &quot;tag:CostCenter&quot;</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">absent     │ missing, then select instance</span>
<span class="l l-Scalar l-Scalar-Plain">│ │ │      - &quot;tag:Project&quot;</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">absent       ─┘</span>
<span class="l l-Scalar l-Scalar-Plain">│ │ │</span>
<span class="l l-Scalar l-Scalar-Plain">│ │ │  actions</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">─────────────────▶ For selected instances, run this action</span>
<span class="l l-Scalar l-Scalar-Plain">│ │ │    - type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">mark-for-op ────▶ Mark instance for operation</span>
<span class="l l-Scalar l-Scalar-Plain">│ │ │      op</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">stop ─────────────▶ Stop instance</span>
<span class="l l-Scalar l-Scalar-Plain">│ │ │      days</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">4 ──────────────▶ After 4 days</span>
<span class="l l-Scalar l-Scalar-Plain">│ │ │</span>
<span class="l l-Scalar l-Scalar-Plain">│ │ ▣────▶ If instance has 10 tags, skip</span>
<span class="l l-Scalar l-Scalar-Plain">│ ▣──────▶ If instance already has a c7n_status, skip</span>
<span class="l l-Scalar l-Scalar-Plain">▣────────▶ If instance is part of an ASG, skip</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="terms">
<h2>Terms<a class="headerlink" href="#terms" title="Permalink to this headline">¶</a></h2>
<dl class="docutils">
<dt>Policy - <a class="reference internal" href="../generated/c7n.html#module-c7n.policy" title="c7n.policy"><code class="xref py py-class docutils literal"><span class="pre">c7n.policy</span></code></a></dt>
<dd>Defined in yaml, specifies a set of filters and actions to take
on a given AWS resource type.</dd>
<dt>Resource - <a class="reference internal" href="../generated/c7n.html#c7n.manager.ResourceManager" title="c7n.manager.ResourceManager"><code class="xref py py-class docutils literal"><span class="pre">c7n.manager.ResourceManager</span></code></a></dt>
<dd>Provides for retrieval of a resources of a given type (typically via AWS API)
and defines the vocabulary of filters and actions that can be used on those
resource (e.g., ASG, S3, EC2, ELBs, etc).</dd>
<dt>Mode</dt>
<dd>Provides for retrieval of a resources of a given type (typically via AWS API) and defines the vocabulary of filters and actions that can be used on those resource. Example resource types are Auto Scaling Groups, S3 buckets, EC2 instances, Elastic Load Balancers, etc).</dd>
</dl>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">mode</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">cloudtrail</span>
  <span class="l l-Scalar l-Scalar-Plain">events</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">RunInstances</span>
</pre></div>
</div>
<dl class="docutils">
<dt>Filters - <a class="reference internal" href="../generated/c7n.filters.html#module-c7n.filters" title="c7n.filters"><code class="xref py py-class docutils literal"><span class="pre">c7n.filters</span></code></a></dt>
<dd>Given a set of resources, how we filter to the subset that we&#8217;re
interested in operating on. The <a class="reference internal" href="filters.html#filters"><span class="std std-ref">filtering language</span></a> has some
default behaviors across resource types like value filtering with JMESPath
expressions against the JSON representation of a resource, as well as
specific filters for particular resources types (instance age,
tag count, etc).</dd>
</dl>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">filters</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="s">&quot;tag:aws:autoscaling:groupName&quot;</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">absent</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ebs</span>
    <span class="l l-Scalar l-Scalar-Plain">key</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Encrypted</span>
    <span class="l l-Scalar l-Scalar-Plain">value</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
    <span class="l l-Scalar l-Scalar-Plain">skip-devices</span><span class="p p-Indicator">:</span>
      <span class="p p-Indicator">-</span> <span class="s">&quot;/dev/sda1&quot;</span>
      <span class="p p-Indicator">-</span> <span class="s">&quot;/dev/xvda&quot;</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">event</span>
    <span class="l l-Scalar l-Scalar-Plain">key</span><span class="p p-Indicator">:</span> <span class="s">&quot;detail.userIdentity.sessionContext.sessionIssuer.userName&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">value</span><span class="p p-Indicator">:</span> <span class="s">&quot;SuperUser&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">op</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ne</span>
</pre></div>
</div>
<dl class="docutils">
<dt>Actions - <a class="reference internal" href="../generated/c7n.html#module-c7n.actions" title="c7n.actions"><code class="xref py py-class docutils literal"><span class="pre">c7n.actions</span></code></a></dt>
<dd>A verb to use on a given resource, i.e. stop, start, suspend,
delete, encrypt, etc.</dd>
</dl>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">actions</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">tag</span>
    <span class="l l-Scalar l-Scalar-Plain">key</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">c7n_status</span>
    <span class="l l-Scalar l-Scalar-Plain">value</span><span class="p p-Indicator">:</span> <span class="s">&quot;Unencrypted</span><span class="nv"> </span><span class="s">EBS!</span><span class="nv"> </span><span class="s">Please</span><span class="nv"> </span><span class="s">recreate</span><span class="nv"> </span><span class="s">with</span><span class="nv"> </span><span class="s">Encryption)&quot;</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">terminate</span>
    <span class="l l-Scalar l-Scalar-Plain">force</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
</pre></div>
</div>
</div>
<div class="section" id="real-time-policies">
<h2>Real-time Policies<a class="headerlink" href="#real-time-policies" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="lambda.html">Lambda Support</a><ul>
<li class="toctree-l2"><a class="reference internal" href="lambda.html#cloudwatch-events">CloudWatch Events</a></li>
<li class="toctree-l2"><a class="reference internal" href="lambda.html#cloud-custodian-integration">Cloud Custodian Integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="lambda.html#configuration">Configuration</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="mu.html">Mu - Lambda Lifecycle Management</a></li>
</ul>
</div>
</div></blockquote>
</div>
<div class="section" id="filters">
<h2>Filters<a class="headerlink" href="#filters" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="filters.html">Value Filters</a></li>
<li class="toctree-l1"><a class="reference internal" href="filters.html#jmespath-filter">JMESPath Filter</a></li>
<li class="toctree-l1"><a class="reference internal" href="usage.html">Usage</a><ul>
<li class="toctree-l2"><a class="reference internal" href="usage.html#module-c7n.filters.offhours">Offhours</a><ul>
<li class="toctree-l3"><a class="reference internal" href="usage.html#resource-scheduling-offhours">Resource Scheduling Offhours</a></li>
<li class="toctree-l3"><a class="reference internal" href="usage.html#features">Features</a></li>
<li class="toctree-l3"><a class="reference internal" href="usage.html#policy-configuration">Policy Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="usage.html#tag-based-configuration">Tag Based Configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="usage.html#policy-examples">Policy examples</a></li>
<li class="toctree-l3"><a class="reference internal" href="usage.html#options">Options</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="usage.html#outputs">Outputs</a><ul>
<li class="toctree-l3"><a class="reference internal" href="usage.html#metrics">Metrics</a></li>
<li class="toctree-l3"><a class="reference internal" href="usage.html#cloudwatch-logs">CloudWatch Logs</a></li>
<li class="toctree-l3"><a class="reference internal" href="usage.html#s3-logs-records">S3 Logs &amp; Records</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div></blockquote>
</div>
<div class="section" id="resources-and-actions">
<h2>Resources and Actions<a class="headerlink" href="#resources-and-actions" title="Permalink to this headline">¶</a></h2>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="resources/ami.html">Amazon Machine Images (AMI)</a></li>
<li class="toctree-l1"><a class="reference internal" href="resources/asg.html">Auto Scaling Groups (ASG)</a></li>
<li class="toctree-l1"><a class="reference internal" href="resources/cache-cluster.html">ElastiCache Clusters</a></li>
<li class="toctree-l1"><a class="reference internal" href="resources/cache-snapshot.html">ElastiCache Cluster Snapshots</a></li>
<li class="toctree-l1"><a class="reference internal" href="resources/cfn.html">CloudFormation</a></li>
<li class="toctree-l1"><a class="reference internal" href="resources/ebs.html">Elastic Block Store Volumes (EBS Volumes)</a></li>
<li class="toctree-l1"><a class="reference internal" href="resources/ebs-snapshot.html">Elastic Block Store Snapshots (EBS Snapshots)</a></li>
<li class="toctree-l1"><a class="reference internal" href="resources/ec2.html">Elastic Cloud Compute (EC2)</a></li>
<li class="toctree-l1"><a class="reference internal" href="resources/elb.html">Elastic Load Balancers (ELB)</a></li>
<li class="toctree-l1"><a class="reference internal" href="resources/kms.html">Key Management Service (KMS)</a></li>
<li class="toctree-l1"><a class="reference internal" href="resources/rds.html">Relational Database Service (RDS)</a></li>
<li class="toctree-l1"><a class="reference internal" href="resources/rds-cluster.html">Relational Database Service DB Clusters (RDS DB Clusters)</a></li>
<li class="toctree-l1"><a class="reference internal" href="resources/rds-cluster-snapshot.html">Relational Database Service DB Cluster Snapshots (RDS DB Cluster Snapshots)</a></li>
<li class="toctree-l1"><a class="reference internal" href="resources/rds-snapshot.html">Relational Database Service DB Snapshots (RDS DB Snapshots)</a></li>
<li class="toctree-l1"><a class="reference internal" href="resources/redshift.html">Redshift</a></li>
<li class="toctree-l1"><a class="reference internal" href="resources/s3.html">Simple Storage Service (S3)</a></li>
</ul>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="lambda.html" class="btn btn-neutral float-right" title="Lambda Support" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../usecases/usecases/tagcompliance.html" class="btn btn-neutral" title="Tag Compliance Across Resources (EC2, ASG, ELB, S3, etc)" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Capital One Services, LLC.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>